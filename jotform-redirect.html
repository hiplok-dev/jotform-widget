<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { 
      margin: 0; 
      padding: 0; 
      width: 1px;
      height: 1px; 
      overflow: hidden; 
    }
  </style>
</head>
<body>
  <script type="text/javascript">
    (function() {
      // Listen for messages from JotForm parent frame
      window.addEventListener('message', function(e) {
        if (e.origin.indexOf('jotform.com') > -1) {
          console.log('Widget received message:', e.data);
          
          var redirectUrl = null;
          
          // Parse the message data
          if (typeof e.data === 'string') {
            try {
              var parsed = JSON.parse(e.data);
              redirectUrl = parsed.href || parsed.url || parsed.thankYouUrl || parsed.redirectUrl;
            } catch(err) {
              if (e.data.indexOf('http') === 0) {
                redirectUrl = e.data;
              }
            }
          } else if (typeof e.data === 'object') {
            redirectUrl = e.data.href || e.data.url || e.data.thankYouUrl || e.data.redirectUrl;
          }
          
          // If we found a Shopify URL, redirect the top window
          if (redirectUrl && redirectUrl.indexOf('xrygxb-ja.myshopify.com') > -1) {
            console.log('Redirecting to:', redirectUrl);
            window.top.location.href = redirectUrl;
          }
        }
      });
      
      // Also try to override parent location changes
      try {
        if (window.parent && window.parent.parent) {
          var grandparent = window.parent.parent;
          var originalLocation = grandparent.location;
          
          Object.defineProperty(grandparent, 'location', {
            set: function(url) {
              if (url && typeof url === 'string' && url.indexOf('http') === 0) {
                window.top.location.href = url;
              } else {
                originalLocation.href = url;
              }
            },
            get: function() {
              return originalLocation;
            }
          });
        }
      } catch(e) {
        // Cross-origin restriction, that's okay
      }
    })();
  </script>
</body>
</html>
